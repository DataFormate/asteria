language: cpp

os: linux
dist: trusty
sudo: required

addons:
  apt:
    update: true
    packages:
      - checkinstall

env:
  - _options=""
  - _options="--enable-debug-logs --enable-debug-checks"

compiler:
  - gcc
  - clang

install:
  - ./check_includes.sh
  - mkdir -p m4
  - autoreconf -ifv
  - test "${CXX#clang}" == "${CXX}" || _options+=" --disable-werror"
  - ./configure
  - make -j$(nproc) DISTCHECK_CONFIGURE_FLAGS="--disable-silent-rules ${_options}" distcheck

script:
  - exit 0

notifications:
  irc:
    channels:
      - "ircs://chat.freenode.net:6697/#mcfproj"
    template:
      - "[ lh_mouse %{repository_slug}#%{commit}] %{result} on %{branch} by %{author} (%{build_url})"
  email: false
